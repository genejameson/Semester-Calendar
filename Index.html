<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body style="font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0;">
    
    <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 20px;">
        <h1>🏛️ Calendar Test</h1>
        <p>Testing basic functionality</p>
    </div>

    <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
        <input type="file" id="testFile" accept=".xlsx,.xls" style="display: block; width: 100%; padding: 15px; font-size: 16px; margin-bottom: 15px;">
        <button onclick="testFunction()" style="background: #DAA520; color: black; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">Test Button</button>
        <div id="status" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">Ready to test</div>
    </div>

    <div id="output" style="background: white; padding: 20px; border-radius: 15px; font-family: monospace; white-space: pre-wrap; min-height: 200px;">
Test Output:
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            const now = new Date().toLocaleTimeString();
            output.textContent += `[${now}] ${message}\n`;
        }

        function testFunction() {
            log('🔘 Test button clicked!');
            
            // Test XLSX library
            if (typeof XLSX !== 'undefined') {
                log('✅ XLSX library is available');
            } else {
                log('❌ XLSX library is NOT available');
            }
            
            // Test file input
            const fileInput = document.getElementById('testFile');
            const file = fileInput.files[0];
            
            if (file) {
                log(`📁 File selected: ${file.name} (${file.size} bytes)`);
                processFile(file);
            } else {
                log('❌ No file selected');
            }
        }

        function processFile(file) {
            log('🔄 Starting file processing...');
            
            try {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    log('✅ FileReader loaded successfully');
                    
                    try {
                        const data = new Uint8Array(e.target.result);
                        log(`📊 File data: ${data.length} bytes`);
                        
                        const workbook = XLSX.read(data, {type: 'array'});
                        log(`📚 Workbook sheets: ${workbook.SheetNames.join(', ')}`);
                        
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        log(`📋 Data rows: ${jsonData.length}`);
                        
                        if (jsonData.length > 0) {
                            log(`📄 Columns: ${Object.keys(jsonData[0]).join(', ')}`);
                            log('🎉 SUCCESS! Excel file processed correctly');
                            
                            document.getElementById('status').textContent = `✅ Success! Found ${jsonData.length} rows`;
                            document.getElementById('status').style.background = '#d4edda';
                            document.getElementById('status').style.color = '#155724';
                        }
                        
                    } catch (error) {
                        log(`❌ Error processing Excel: ${error.message}`);
                    }
                };
                
                reader.onerror = function() {
                    log('❌ FileReader error');
                };
                
                reader.readAsArrayBuffer(file);
                
            } catch (error) {
                log(`❌ Error: ${error.message}`);
            }
        }

        // Test on page load
        window.addEventListener('load', function() {
            log('🚀 Page loaded');
            log('🔍 Testing basic functionality...');
            
            if (typeof XLSX !== 'undefined') {
                log('✅ XLSX library loaded on page load');
            } else {
                log('❌ XLSX library failed to load');
            }
            
            log('📱 Ready for testing - select an Excel file and click Test Button');
        });

        // Test file input
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('testFile');
            fileInput.addEventListener('change', function() {
                log('📁 File input changed');
                const file = this.files[0];
                if (file) {
                    log(`📄 File selected automatically: ${file.name}`);
                }
            });
        });
    </script>
</body>
</html>